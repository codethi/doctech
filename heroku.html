<!DOCTYPE html>
<html lang="pt-br">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>DOCTECH</title>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

   <link rel="stylesheet" href="./assets/css/style.css">
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

   <link rel="icon" type="imagem/png" href="./assets/img/logotipo(branco).png" />
</head>

<body id="style-2">
   <!--Menu Lateral-->
   <div class="sidebar-container" id="style-1">
      <div class="sidebar-logo">
         Deploy no Heroku
      </div>
      <ul class="sidebar-navigation nav" id="navigation">
         <li>
            <a href="index.html" class="text-white">
               <i class="fa fa-home" aria-hidden="true"></i> Inicio
            </a>
         </li>

         <li class="header">Navegação</li>
         <li>
            <a href="#heroku">
               O que é o Heroku?
            </a>
         </li>

         <li>
            <a href="#veremos">
               O que veremos?
            </a>
         </li>

         <li>
            <a href="#um-passo">
               #01 Passo
            </a>
         </li>

         <li>
            <a href="#dois-passo">
               #02 Passo
            </a>
         </li>

         <li>
            <a href="#tres-passo">
               #03 Passo
            </a>
         </li>

         <li>
            <a href="#quatro-passo">
               #04 Passo
            </a>
         </li>

         <li>
            <a href="#cinco-passo">
               #05 Passo
            </a>
         </li>

         <li>
            <a href="#seis-passo">
               #06 Passo
            </a>
         </li>

         <li>
            <a href="#sete-passo">
               #07 Passo
            </a>
         </li>

         <li>
            <a href="#oito-passo">
               #08 Passo
            </a>
         </li>

         <li>
            <a href="#nove-passo">
               #09 Passo
            </a>
         </li>

         <li>
            <a href="#dez-passo">
               #10 Passo
            </a>
         </li>

         <li>
            <a href="#onze-passo">
               #11 Passo
            </a>
         </li>

         <li>
            <a href="#doze-passo">
               #12 Passo
            </a>
         </li>

      </ul>
   </div>
   <!--/Menu Lateral-->

   <!--Conteúdo-->
   <div class="content-container mb-5">

      <div class="container-fluid scrollspy-example" data-spy="scroll" data-target="#navigation" data-offset="0">

         <div class="row" id="heroku">
            <div class="col-md-12">
               <h2>O que é o Heroku?</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>O Heroku é uma plataforma de cloud que oferece "Platform as a Service", ou seja, ele permite que você
                  hospede suas aplicações em um ambiente facilmente escalável e com suporte a várias tecnologias. Ele
                  tem um plano free, que é indicado para testes, e opções pagas com mais funcionalidades e suporte.</p>
            </div>
         </div>

         <div class="row" id="veremos">
            <div class="col-md-12">
               <h2>O que veremos por aqui?</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Esse documento é um passo a passo para você subir (deploy) o seu site criado em SPRING e ANGULAR
                  gratuitamente para o Heroku, que é uma aplicação de hospedagem de site na web, isso irá gerar um link
                  de acesso a sua página que poderá ser acessadoem qualquer lugar. Para realizar esse deploy vamos
                  precisar fazer algumas modificações em nosso projeto e principalmente já <b>criar uma conta no
                     Heroku</b> através desse endereço: <b><a href="https://www.heroku.com"
                        target="_blanck">https://www.heroku.com</a></b>.</p>
            </div>
         </div>

         <hr class="mt-5 mb-5 w-75">

         <div class="row" id="um-passo">
            <div class="col-md-12">
               <h2>#01 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Com a conta já criada, mude todos os endpoints do front-end de:</p>
               <pre>http://localhost8080/endpoint</pre>
               <p>Para:</p>

               <pre>https://nomedoprojeto.herokuapp.com/endpoint</pre>

               <h6>Exemplo:</h6>
               <img class="img-fluid" src="https://i.imgur.com/HG0E2PG.png" alt="">

               <p class="text-danger font-italic font-weight-bold mt-1">Não pode existir nenhum nome de projeto igual,
                  ou seja, crie um nome diferenciado para o seu projeto e fique atento se esse nome já existe, durante a
                  criação do projeto no fim desse documento.</p>
            </div>
         </div>


         <div class="row mt-3" id="dois-passo">
            <div class="col-md-12">
               <h2>#02 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Faça o build do projeto utilizando o terminal, localizado na pasta do projeto, com o código:</p>

               <pre>ng build --prod</pre>

            </div>
         </div>

         <div class="row mt-3" id="tres-passo">
            <div class="col-md-12">
               <h2>#03 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Crie uma nova pasta para o deploy e coloque todo o seu back-end nessa pasta (iremos modifica-lo, por
                  isso é importante manter o original)</p>
            </div>
         </div>

         <div class="row mt-3" id="quatro-passo">
            <div class="col-md-12">
               <h2>#04 Passo</h2>
            </div>
         </div>

         <div class="row ">
            <div class="col-md-12">
               <p>Crie na pasta <b>resources</b>, uma pasta chamada <b>public</b>. Pegue apenas os aquivos da pasta
                  <b>dist/blogPessoal</b> e coloque dentro nessa pasta public:</p>

               <h6>Exemplo:</h6>

               <img class="img-fluid" src="https://i.imgur.com/ytmirM7.png" alt="">

            </div>
         </div>

         <div class="row mt-3" id="cinco-passo">
            <div class="col-md-12">
               <h2>#05 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Substitua o conteúdo do arquivo aplication.properties, para:</p>
<pre>spring.mvc.view.prefix=/public/
spring.mvc.view.suffix=.html	

server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

spring.jpa.generate-ddl=true
spring.datasource.url=${JDBC_DATASOURCE_URL}
spring.jpa.show-sql=true</pre>
            
               <h6 class="mt-2">Exemplo:</h6>

               <img class="img-fluid" src="https://i.imgur.com/XV9sbsm.png" alt="">

            </div>
         </div>

         <div class="row mt-3" id="seis-passo">
            <div class="col-md-12">
               <h2>#06 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Abra o <b>pom.xml</b> e substitua a dependência do MySql por essa dependência:</p>
<pre>
&lt;dependency&gt;
   &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
   &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
   &lt;version&gt;42.2.12&lt;/version&gt;
&lt;/dependency&gt;
</pre>
            
               <p class="text-danger mt-3">O Heroku só possui gratuidade para banco de dados <a target="_blank" href="http://pgdocptbr.sourceforge.net/pg82/intro-whatis.html">postgresql</a>, isso não muda nada além dessa dependência e da alteração no aplication.properties feita acima.</p>

            </div>
         </div>

         <div class="row mt-3" id="sete-passo">
            <div class="col-md-12">
               <h2>#07 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Agora precisamos configurar o spring para que o Heroku assuma as rotas do Angular, para isso será necessário criar um novo package no src/main/java, chamado <b>config</b>, dentro desse package, crie uma nova classe chamada <b>MyAppWebMvcConfigurer</b>, dentro dessa classe, preserve a primeira linha do código e substitua as demais com esse código:</p>
              
<pre>
   import java.io.IOException;

	import org.springframework.context.annotation.Configuration;
	import org.springframework.core.io.ClassPathResource;
	import org.springframework.core.io.Resource;
	import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
	import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
	import org.springframework.web.servlet.resource.PathResourceResolver;

	@Configuration
	public class MyAppWebMvcConfigurer implements WebMvcConfigurer {

	@Override
    	public void addResourceHandlers(ResourceHandlerRegistry registry) {
        	registry.addResourceHandler("/**/*")
            	.addResourceLocations("classpath:/public/")
            	.resourceChain(true)
            	.addResolver(new PathResourceResolver() {
                	@Override
                	protected Resource getResource(String resourcePath, Resource location) throws IOException {
                    	Resource requestedResource = location.createRelative(resourcePath);
                    	return requestedResource.exists() && requestedResource.isReadable() ? requestedResource : new ClassPathResource("/public/index.html");
                		}
            		});
    		}
	}
</pre>

<h6 class="mt-3">Exemplo:</h6>

<img class="img-fluid mt-3" src="https://i.imgur.com/sT7TBGJ.png" alt="">

            </div>
         </div>


         <div class="row mt-3" id="oito-passo">
            <div class="col-md-12">
               <h2>#08 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Agora precisamos liberar as rotas do back-end, para isso basta ir no arquivo <b>BasicSecurityConfig.java</b> no método <i>protected void configure(HttpSecurity http) throws Exceptione</i> adicionar essa linha:</p>

               <pre>.antMatchers("/**").permitAll() </pre>

               <h6 class="mt-3">Exemplo:</h6>

               <img class="img-fluid mt-3" src="https://i.imgur.com/Gd0bQdq.png" alt="">

            </div>
         </div>

         <div class="row mt-3" id="nove-passo">
            <div class="col-md-12">
               <h2>#09 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Pronto, agora só precisamos abrir a <strong>pasta que contém o arquivo pom.xml</strong> no terminal de sua escolha e digite os seguintes comandos para criar um repositório no git:</p>

<pre>git init
git add .
git commit -m "mensagem"  </pre>

            </div>
         </div>

         <div class="row mt-3" id="dez-passo">
            <div class="col-md-12">
               <h2>#10 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Agora precisamos configurar o Heroku no terminal, porém antes de iniciar precisamos instalar o heroku através do pacote npm:</p>

               <pre>npm i -g heroku</pre>

               <p>Agora é só fazer o login no heroku e continuar as configurações:</p>

               <pre>heroku login</pre>
      
               <p>Após a execução desse comando será aberta em seu navegador uma página da Heroku com um botão para você logar, clique nele, volte para o terminal e prossiga com as configurações.</p>
      
               <pre>heroku create nomedoprojeto  //mesmo nome usado nos endpoints</pre>
      
               <p>Esse comando serve para criar o seu projeto na Heroku. <b>Não se esqueça de colocar o mesmo nome atribuido nos end-points do front-end, configuração que foi feita no primeiro passo desse documento.</b></p>
      
               <pre>heroku addons:create heroku-postgresql:hobby-dev</pre>
      
               <p>Esse comando serve para criar o banco de dados do seu projeto na Heroku.</p>
            </div>
         </div>

         <div class="row mt-3" id="onze-passo">
            <div class="col-md-12">
               <h2>#11 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Para finalizar só precisamos digitar o seguinte comando, ainda no terminal:</p>
               <pre>git push heroku master</pre>
               <p>No próprio terminal irá aparecer a url que você precisa entrar para abrir o projeto no navegador, mas normalmente a url é <a href="#onze-passo">https://nomedoprojeto.heroku.com</a>.</p>
            </div>
         </div>

         <div class="row mt-3" id="doze-passo">
            <div class="col-md-12">
               <h2>#12 Passo</h2>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <p>Sempre que quisermos atualizar o projeto, basta alteramos os arquivos necessários e execultar esses três comandos no terminal, dentro da pasta do projeto:</p>
<pre>git add .
git commit -m "mensagem"  
git push heroku master</pre>
            </div>
         </div>

         <hr class="mt-3 mb-4 w-50">

         <div class="jumbotron p-2 ">
            <h5 class="obs">Observação:</h5>
            <p class="m-0">Como o servidor é gratuido, se ele não tiver requisições de 30 em 30 minutos ele “dorme” e a próxima pessoa a acessá-lo enfrentará uma pequena demora para visualizar a página, isso por que o servidor estará inciando.</p>
         </div>
               
         
      </div>
   </div>

   <!--/Conteúdo-->


   <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"></script>
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"></script>
</body>

</html>